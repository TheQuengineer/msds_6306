---
title: "Unit10ExploratoryDataAnalysis"
author: "Quentin Thomas"
date: "3/10/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Questions

**1.** **Mental Health Clinics**

**`a.`** This data set is a survey of every known healthcare facility that offers mental health services in the United States in 2015. Navigate to [here](https://datafiles.samhsa.gov/study-dataset/national-mental-health-services-survey-2015-n-mhss-2015-ds0001-nid17098)
and select the R download. Look through the codebook PDF for an explanation on certain variables. Upon opening the RDA file, the data set should be inserted into global environment, which you can then reference.

### Variables of Interest in codebook

- `STATE` LST
- `FACILITYTYPE` (Veterans Administration medical center (VAMC) or other VA health care facility)

**`b.`** Please create code which lists the State abbreviations without their counts, one abbreviation per State vlaue. It does not have to be in data frame format. A vector is fine.

```{r}
library(stringr)

load("N-MHSS-2015-DS0001-data-r.rda")
states <- str_trim(levels(mh2015_puf$LST))
states
```

**`c.`** Filter the data.frame from 1A. We are only interested in the Veterans Administration (VA) medical centers in the mainland United
States-create a listing of counts of these centers by state, including only mainland locations. Alaska, Hawaii, and U.S. territories should be omitted. DC while not a state, is in the mainland, so it should remain included. Convert this to data.frame()

```{r}
library(dplyr)
va_data <- filter(mh2015_puf, FACILITYTYPE == "Veterans Administration medical center (VAMC) or other VA health care facility")
unwanted_territoris <- c("AK    ", "HI    ", "AS    ","VI    ","PR    ","GU    ")
mainland_us <- filter_all(va_data, all_vars(!va_data$LST %in% levels(factor(unwanted_territoris))))
mainland_us <- droplevels(mainland_us)
va_counts_by_state <- data.frame(table(mainland_us$LST))
names(va_counts_by_state) <- c("State", "NumberOfLocations")
va_counts_by_state
```

**`d.`** Create a ggplot barchart of this filtered data set. Vary the bar's colors by what State it has listed. Give it an appropriately
professional title that is `centered`. Make sure you have informative axis labels. The State axis should be readable, not layered over each other. You're welcome to have a legend or not.

```{r}
library(ggplot2)

state_theme <- theme(plot.title = element_text(face = "bold",
                                               size = 18,
                                               color = "black"),
                     axis.text.x = element_text(size = 12),
                     axis.text.y = element_text(face = "bold", size = 6),
                     axis.title.x = element_text(face = "bold.italic", color = "black", size = 18),
                     axis.title.y = element_text(face ="bold.italic", color = "black", size = 18))

ggplot(data = va_counts_by_state, aes(x= State, y =NumberOfLocations, fill= State)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  coord_flip() +
  labs(title = "VA Centers by State (US Mainland)") +
  state_theme

```

**2.** **Cleaning and Bringing in New Features**

**`a.`** This graph (1D) might be somewhat misleading, as bigger states may have more hospitals, but could be more sparsely located. Read statesize.csv into your R environment. This contains essentially a vector of square miles for each state. In trying to merge it with your data.frame() from 1C, you find that they don't match. Use `paste()` on your LST column in 1C to see what the matter is, and write what you observe in a comment